
<!DOCTYPE html>
<html>
<head>
					<style>
					.button {
					  border: none;
					  color: white;
					  padding: 15px 32px;
					  text-align: center;
					  text-decoration: none;
					  display: inline-block;
					  font-size: 16px;
					  margin: 4px 2px;
					  cursor: pointer;
					}
					
					.button1 {background-color: #4CAF50;} /* Green */
					
					.slidecontainer {
					  width: 100%;
					}

					.slider {
					  -webkit-appearance: none;
					  width: 100%;
					  height: 25px;
					  background: #d3d3d3;
					  outline: none;
					  opacity: 0.7;
					  -webkit-transition: .2s;
					  transition: opacity .2s;
					}

					.slider:hover {
					  opacity: 1;
					}

					.slider::-webkit-slider-thumb {
					  -webkit-appearance: none;
					  appearance: none;
					  width: 25px;
					  height: 25px;
					  background: #04AA6D;
					  cursor: pointer;
					}

					.slider::-moz-range-thumb {
					  width: 25px;
					  height: 25px;
					  background: #04AA6D;
					  cursor: pointer;
					}

					tr td:last-child {
						width: 1%;
						white-space: nowrap;
					}
					tr td:first-child {
						width: 1%;
						white-space: nowrap;
					}
					</style>
</head>
<body>
					
					<span id="autogeneratedHTML"></span>
					
					
					<script>
						function sendBinary(data, filename, callback){
							document.body.classList.add('busy-cursor');
							var xmlhttp;
							if (window.XMLHttpRequest) {
								// code for IE7+, Firefox, Chrome, Opera, Safari
								xmlhttp = new XMLHttpRequest();
							} else {
								// code for IE6, IE5
								xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
							}
							xmlhttp.onreadystatechange = function() {
								if (this.readyState == 4 && this.status != 200) {
									document.body.classList.remove('busy-cursor');
									//document.getElementById("txtHint").innerHTML = this.responseText;
									alert("sending to server failed. Error code is " + this.status);
									//don't connect
								}
								if(this.readyState == 4 && this.status == 200){
									document.body.classList.remove('busy-cursor');
									//write to server successful
									callback();
								}
							};

							xmlhttp.open("POST",filename,true);//can be accessed through "$_GET"
							
							//This is required to disable caching
							//disableCache(xmlhttp);
							
							xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
							xmlhttp.send(data);//can be accessed and stored through file_put_contents(filename, file_get_contents('php://input'));
						}
						
						function downloadConfig(){
							var xhr = new XMLHttpRequest();
							xhr.open('GET', 'getConfig', true);
							xhr.responseType = 'arraybuffer';
							xhr.onload = function(e){
								var arrayBuffer = xhr.response;
								if(arrayBuffer){
									var floatArray = new Float32Array(arrayBuffer);
									for(let i = 0; i < numConfigValues; i++){
										configValues[i] = floatArray[i];
									}
								}
							}
							xhr.send();
						}
						
						function downloadOrientation(){
							var xhr = new XMLHttpRequest();
							xhr.open('GET', 'getOrientation', true);
							xhr.responseType = 'arraybuffer';
							xhr.onload = function(e){
								var arrayBuffer = xhr.response;
								if(arrayBuffer){
									var floatArray = new Float32Array(arrayBuffer);
									for(let i = 0; i < 9; i++){
										//orientationValues[i] = floatArray[i];
									}
								}
							}
							xhr.send();
						}
						
						function uploadConfig(){
							const array = ['abcdefgh']; // an array consisting of a single string
							// TODO: floats to char array.
							const blob = new Blob(array, { type: "text/html" }); // the blob
							
							//sendBinary(blob, "uploadNewConstants", function(){/*do something on UI side when data has been sent successfully*/});
						}
						
						function controlActuators(elevonLeft, elevonRight, propellerLeft, propellerRight){
							const array = ['abcdefgh']; // an array consisting of a single string
							// TODO: floats to char array.
							const blob = new Blob(array, { type: "text/html" }); // the blob
							
							//sendBinary(blob, "uploadNewConstants", function(){/*do something on UI side when data has been sent successfully*/});
						}
						
						
						var numConfigValues = 36;
						var numActuatorsWithoutConfig = 2;
						var configValues = new Array(numConfigValues).fill(0);
						
						var jsFunctions = new Array(numConfigValues + numActuatorsWithoutConfig);
						
						
						// AUTO GENERATED
						
						var UIstring = "";
						function addServo(name, index){
							UIstring += "\
								<tr>\
									<td><p>" + name + "=<br><span id=\"value" + index + "\"></span></p></td>\
									<td><div class=\"slidecontainer\">\
								  		<input type=\"range\" min=\"-90\" max=\"90\" value=\"0\" class=\"slider\" id=\"slider" + index + "\">\
									</div></td>\
									<td><button id=\"invert" + index + "Button\" class=\"button button1\">Invert</button><button id=\"zero" + index + "Button\" class=\"button button1\">0</button></td>\
								</tr>\
							";
							jsFunctions[index] = function(){
								window["slider" + index] = document.getElementById("slider" + index);
								window["value" + index] = document.getElementById("value" + index);
								window["value" + index].innerHTML = window["slider" + index].value;

								window["slider" + index].oninput = function() {
								  window["value" + index].innerHTML = this.value;
								  //controlActuators(window["slider" + index].value, window["slider" + index].value, 0, 0);
								}
								document.getElementById("invert" + index + "Button").onclick = function() {
									configValues[index] *= -1;
									uploadConfig();
								}
								document.getElementById("zero" + index + "Button").onclick = function() {
									window["value" + index].innerHTML = window["slider" + index].value = 0;
								}
							};
						}
						
						function addPropeller(name, index){
							UIstring += "\
								<tr>\
									<td><p>" + name + "=<br><span id=\"value" + index + "\"></span></p></td>\
									<td><div class=\"slidecontainer\">\
								  		<input type=\"range\" min=\"0\" max=\"90\" value=\"0\" class=\"slider\" id=\"slider" + index + "\">\
									</div></td>\
									<td><button id=\"zero" + index + "Button\" class=\"button button1\">0</button></td>\
								</tr>\
							";
							jsFunctions[index] = function(){
								window["slider" + index] = document.getElementById("slider" + index);
								window["value" + index] = document.getElementById("value" + index);
								window["value" + index].innerHTML = window["slider" + index].value;

								window["slider" + index].oninput = function() {
								  window["value" + index].innerHTML = this.value;
								  //controlActuators(window["slider" + index].value, window["slider" + index].value, 0, 0);
								}
								//window["slider" + index].onchange = ...
								
								document.getElementById("zero" + index + "Button").onclick = function() {
									window["value" + index].innerHTML = window["slider" + index].value = 0;
								}
							};
						}
						
						function addSwitch(name, index){
							UIstring += "\
								<tr>\
									<td></td>\
									<td></td>\
									<td><button id=\"switch" + index + "Button\" class=\"button button1\">Switch " + name + "</button></td>\
								</tr>\
							";
							jsFunctions[index] = function(){
								
								document.getElementById("switch" + index + "Button").onclick = function() {
									configValues[index] = (configValues[index] == 0) ? 1 : 0;
									uploadConfig();
								}
							};
						}
						
						function addPIDConstant(name, index){
							UIstring += "\
								<tr>\
									<td><p>" + name + "=<br><span id=\"value" + index + "\"></span></p></td>\
									<td><button id=\"Down" + index + "Button\" class=\"button button1\">&#8681</button>\
									<button id=\"Up" + index + "Button\" class=\"button button1\">&#8679</button></td>\
									<td></td>\
								</tr>\
							";
							jsFunctions[index] = function(){
								window["value" + index] = document.getElementById("value" + index);
								configValues[index] = 1;//TODO remove when real values exist.
								window["value" + index].innerHTML = configValues[index];
								
								document.getElementById("Up" + index + "Button").onclick = function() {
									configValues[index] *= 1.1;
									window["value" + index].innerHTML = configValues[index].toFixed(2);
									uploadConfig();
								}
								document.getElementById("Down" + index + "Button").onclick = function() {
									configValues[index] /= 1.1;
									window["value" + index].innerHTML = configValues[index].toFixed(2);
									uploadConfig();
								}
							};
						}
						
						function addDegrees(name, index){
							UIstring += "\
								<tr>\
									<td><p>" + name + "=<br><span id=\"value" + index + "\"></span></p></td>\
									<td><button id=\"Down" + index + "Button\" class=\"button button1\">&#8681</button>\
									<button id=\"Up" + index + "Button\" class=\"button button1\">&#8679</button></td>\
									<td></td>\
								</tr>\
							";
							jsFunctions[index] = function(){
								window["value" + index] = document.getElementById("value" + index);
								configValues[index] = 45;//TODO remove when real values exist.
								window["value" + index].innerHTML = configValues[index];
								
								document.getElementById("Up" + index + "Button").onclick = function() {
									configValues[index] += 1;
									window["value" + index].innerHTML = configValues[index].toFixed(0);
									uploadConfig();
								}
								document.getElementById("Down" + index + "Button").onclick = function() {
									configValues[index] -= 1;
									window["value" + index].innerHTML = configValues[index].toFixed(0);
									uploadConfig();
								}
							};
						}
						
						function addHeight(name, index, lowerBound){
							UIstring += "\
								<tr>\
									<td><p>" + name + "=<br><span id=\"value" + index + "\"></span></p></td>\
									<td><button id=\"Down" + index + "Button\" class=\"button button1\">&#8681</button>\
									<button id=\"Up" + index + "Button\" class=\"button button1\">&#8679</button></td>\
									<td></td>\
								</tr>\
							";
							jsFunctions[index] = function(){
								window["value" + index] = document.getElementById("value" + index);
								configValues[index] = 0.5;//TODO remove when real values exist.
								window["value" + index].innerHTML = configValues[index];
								
								document.getElementById("Up" + index + "Button").onclick = function() {
									configValues[index] += 0.5;
									window["value" + index].innerHTML = configValues[index].toFixed(1);
									uploadConfig();
								}
								document.getElementById("Down" + index + "Button").onclick = function() {
									configValues[index] -= 0.5;
									configValues[index] = Math.max(lowerBound, configValues[index]);
									window["value" + index].innerHTML = configValues[index].toFixed(1);
									uploadConfig();
								}
							};
						}
						
						//downloadConfig();
						
						//TODO: read configValues from Kite
						let tableBegin = "\
								<table style=\"width:100%\">\
								<tbody>\
						";
						let tableEnd = "\
								</tbody></table>\
						";
						
						UIstring += "<h3>Actuator Tests and Config</h3>";
						UIstring += tableBegin;
								
						addServo("Brake", 10);
						addServo("Left Elevon", 7);
						addServo("Right Elevon", 8);
						addSwitch("Elevons", 9);
						addPropeller("Left Prop", numConfigValues + 0);
						addPropeller("Right Prop", numConfigValues + 1);
						addSwitch("Props", 11);
						
						UIstring += tableEnd;
						UIstring += "<h3>Eight Flying Config</h3>";
						UIstring += tableBegin;
						
						addHeight("sidewaysTime", 12, 0.5)
						addHeight("turningSpeed", 13, 0.5)
						addPIDConstant("eight.Z.P", 27);
						addPIDConstant("eight.Z.D", 28);
						addPIDConstant("eight.Y.D", 29);
						addDegrees("eightElevator", 30);
						addDegrees("transitionYAngle", 31);
						addDegrees("desiredLineAngle", 32);
						addDegrees("betaClamp", 33);//TODO
						addPIDConstant("beta.P", 34);
						
						UIstring += tableEnd;
						UIstring += "<h3>Hover Launch Config</h3>";
						UIstring += tableBegin;
						
						addPIDConstant("hover.Y.P", 14);
						addPIDConstant("hover.Y.D", 15);
						addDegrees("yAngleOffset", 16)
						addPIDConstant("hover.Z.P", 17);
						addPIDConstant("hover.Z.D", 18);
						addPIDConstant("hover.X.D", 19);
						addPIDConstant("hover.H.P", 20);
						addPIDConstant("hover.H.D", 21);
						
						UIstring += tableEnd;
						UIstring += "<h3>Landing Config</h3>";
						UIstring += tableBegin;
						
						addDegrees("brake", 22)
						addPIDConstant("land.Y.P", 23);
						addPIDConstant("land.Y.D", 24);
						addPIDConstant("land.X.P", 25);
						addHeight("landHeight", 26, -100)
						
						UIstring += tableEnd;
						
						document.getElementById("autogeneratedHTML").innerHTML = UIstring;
						
						for(let i = 0; i < numConfigValues + numActuatorsWithoutConfig; i++){
							if(typeof jsFunctions[i] === 'function'){
								jsFunctions[i]();
							}
						}
						
						
					</script>
</body>
</html>



